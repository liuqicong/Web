webpackJsonp([50],{C3F4:function(t,i,o){var e=o("zmYn");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);o("rjj0")("3b8c2266",e,!1,{})},M7VE:function(t,i,o){"use strict";function e(t){P||o("C3F4")}Object.defineProperty(i,"__esModule",{value:!0});var s=o("Dd8w"),r=o.n(s),n=o("rHil"),a=o("ABCa"),c=o("EmH9"),p=o("2sLL"),u=o("LeAj"),l=o("HD9R"),d=o("62KO"),f=o("ghf0"),m=o("NYxO"),h=o("FWaR"),g=(r()({watchProduct:function(){var t=0;this.productSelected=!0;for(var i=0;i<this.product.length;i++)this.product[i].selected?t+=this.product[i].orderRatioPrice*this.product[i].shopCartNum:this.productSelected=!1,0===this.product[i].shopCartNum&&this.product.splice(i,1);this.productTotalPrice=Math.round(100*t)/100,this.watchTotalPriceExclude(3),this.setDot(this)},watchPromotion:function(){var t=0,i=0;this.promotionSelected=!0;for(var o=!1,e=0;e<this.promotion.length;e++){var s=this.promotion[e],r=s.promotionRuleVO.productList,n=s.promotionRuleVO.rules,a=s.promotionRuleVO.relation,c=0,p=0;if(0===s.type){o=!0;for(var u=0,l=0;l<r.length;l++)r[l].selected?u+=r[l].shopCartNum*r[l].orderRatioPrice:this.promotionSelected=!1;s.promotionTotalPrice=u,s.keyProductPrice=Math.round(100*u)/100,i+=s.keyProductPrice,t+=s.promotionTotalPrice}if(1===s.type){o=!0;for(var d=0,f=0;f<r.length;f++)r[f].selected?(c+=r[f].shopCartNum,p+=r[f].shopCartNum*r[f].orderRatioPrice,d+=r[f].shopCartNum*r[f].orderRatioPrice):this.promotionSelected=!1;s.keyProductPrice=Math.round(100*d)/100;for(var m=0;m<n.length;m++)if(n[m].byMoney)if(n[m].sum<=p&&n[m].min<=c)if(n[m].products.length){for(var h=0,g=0,v=0;v<n[m].products.length;v++)for(var L=0;L<r.length;L++)n[m].products[v]===r[L].pCode&&r[L].selected&&(h+=r[L].shopCartNum*r[L].orderRatioPrice,g+=r[L].shopCartNum);if(n[m].sum<=h&&n[m].min<=g){n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var x=0;x<n[m].giftList.length;x++){var C=Math.floor(h/n[m].sum),P=n[m].infinite||C<=n[m].loop?C:n[m].loop,y=n[m].giftList[x].maxQuotaQty;null!==n[m].giftList[x].avaliableWithRatioQty?n[m].giftList[x].maxQuotaQty=Math.min(P*n[m].giftList[x].productNum,n[m].giftList[x].avaliableWithRatioQty):n[m].giftList[x].maxQuotaQty=P*n[m].giftList[x].productNum,n[m].giftList[x].orderRatioPrice?n[m].giftList[x].shopCartNum=y===n[m].giftList[x].shopCartNum?n[m].giftList[x].maxQuotaQty:Math.min(n[m].giftList[x].maxQuotaQty,n[m].giftList[x].shopCartNum):n[m].giftList[x].shopCartNum=n[m].giftList[x].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[x].selected=n[m].giftList[x].orderRatioPrice&&n[m].giftList[x].isHave&&2!==n[m].giftList[x].pStatus||!n[m].giftList[x].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var w=0;w<n[m].giftList.length;w++)n[m].giftList[w].shopCartNum=0,n[m].giftList[w].maxQuotaQty=0,n[m].giftList[w].selected=!1}}else{n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var _=0;_<n[m].giftList.length;_++){var b=Math.floor(p/n[m].sum),Q=n[m].infinite||b<=n[m].loop?b:n[m].loop,N=n[m].giftList[_].maxQuotaQty;null!==n[m].giftList[_].avaliableWithRatioQty?n[m].giftList[_].maxQuotaQty=Math.min(Q*n[m].giftList[_].productNum,n[m].giftList[_].avaliableWithRatioQty):n[m].giftList[_].maxQuotaQty=Q*n[m].giftList[_].productNum,n[m].giftList[_].orderRatioPrice?n[m].giftList[_].shopCartNum=N===n[m].giftList[_].shopCartNum?n[m].giftList[_].maxQuotaQty:Math.min(n[m].giftList[_].maxQuotaQty,n[m].giftList[_].shopCartNum):n[m].giftList[_].shopCartNum=n[m].giftList[_].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[_].selected=n[m].giftList[_].orderRatioPrice&&n[m].giftList[_].isHave&&2!==n[m].giftList[_].pStatus||!n[m].giftList[_].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var k=0;k<n[m].giftList.length;k++)n[m].giftList[k].shopCartNum=0,n[m].giftList[k].maxQuotaQty=0,n[m].giftList[k].selected=!1}else if(n[m].num<=c&&n[m].min<=c)if(n[m].products.length){for(var R=0,E=0;E<n[m].products.length;E++)for(var O=0;O<r.length;O++)n[m].products[E]===r[O].pCode&&r[O].selected&&(R+=r[O].shopCartNum);if(n[m].num<=R&&n[m].min<=R){n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var S=0;S<n[m].giftList.length;S++){var T=Math.floor(R/n[m].num),V=n[m].infinite||T<=n[m].loop?T:n[m].loop,z=n[m].giftList[S].maxQuotaQty;null!==n[m].giftList[S].avaliableWithRatioQty?n[m].giftList[S].maxQuotaQty=Math.min(V*n[m].giftList[S].productNum,n[m].giftList[S].avaliableWithRatioQty):n[m].giftList[S].maxQuotaQty=V*n[m].giftList[S].productNum,n[m].giftList[S].orderRatioPrice?n[m].giftList[S].shopCartNum=z===n[m].giftList[S].shopCartNum?n[m].giftList[S].maxQuotaQty:Math.min(n[m].giftList[S].maxQuotaQty,n[m].giftList[S].shopCartNum):n[m].giftList[S].shopCartNum=n[m].giftList[S].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[S].selected=n[m].giftList[S].orderRatioPrice&&n[m].giftList[S].isHave&&2!==n[m].giftList[S].pStatus||!n[m].giftList[S].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var M=0;M<n[m].giftList.length;M++)n[m].giftList[M].shopCartNum=0,n[m].giftList[M].maxQuotaQty=0,n[m].giftList[M].selected=!1}}else{n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var H=0;H<n[m].giftList.length;H++){var q=Math.floor(c/n[m].num),$=n[m].infinite||q<=n[m].loop?q:n[m].loop,D=n[m].giftList[H].maxQuotaQty;null!==n[m].giftList[H].avaliableWithRatioQty?n[m].giftList[H].maxQuotaQty=Math.min($*n[m].giftList[H].productNum,n[m].giftList[H].avaliableWithRatioQty):n[m].giftList[H].maxQuotaQty=$*n[m].giftList[H].productNum,n[m].giftList[H].orderRatioPrice?n[m].giftList[H].shopCartNum=D===n[m].giftList[H].shopCartNum?n[m].giftList[H].maxQuotaQty:Math.min(n[m].giftList[H].maxQuotaQty,n[m].giftList[H].shopCartNum):n[m].giftList[H].shopCartNum=n[m].giftList[H].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[H].selected=n[m].giftList[H].orderRatioPrice&&n[m].giftList[H].isHave&&2!==n[m].giftList[H].pStatus||!n[m].giftList[H].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var G=0;G<n[m].giftList.length;G++)n[m].giftList[G].shopCartNum=0,n[m].giftList[G].maxQuotaQty=0,n[m].giftList[G].selected=!1}if(1===a){if(n.filter(function(t){return t.active}).length){0===n.filter(function(t){return 2===t.chose||3===t.chose}).length&&function(){var t=n.filter(function(t){return t.byMoney}).length,i=0;if(0===t)n.forEach(function(t,o,e){t.active&&(i=t.num>e[i].num?o:i)});else if(t===n.length)n.forEach(function(t,o,e){t.active&&(i=t.sum>e[i].sum?o:i)});else for(var o=0;o<n.length;o++)if(n[o].active){i=o;break}for(var e=0;e<n.length;e++)e===i?(n[e].chose=1,n[e].giftList=n[e].giftList.map(function(t){return t.selected=t.orderRatioPrice&&t.isHave&&2!==t.pStatus||!t.orderRatioPrice,t})):(n[e].chose=0,n[e].giftList=n[e].giftList.map(function(t){return t.selected=!1,t}))}()}}n.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(d+=t.shopCartNum*t.orderRatioPrice)})}),s.promotionTotalPrice=Math.round(100*d)/100,i+=s.keyProductPrice,t+=s.promotionTotalPrice}if(4===s.type){o=!0;for(var W=0,I=0;I<r.length;I++)r[I].selected?W+=r[I].shopCartNum*r[I].orderRatioPrice:this.promotionSelected=!1;for(var U=0;U<n.length;U++)if(s.selected){n[U].active=!0,n[U].chose=1;for(var Z=0;Z<n[U].giftList.length;Z++){var F=n[U].giftList[Z].maxQuotaQty;n[U].giftList[Z].maxQuotaQty=null!==n[U].giftList[Z].avaliableWithRatioQty?Math.min(n[U].giftList[Z].avaliableWithRatioQty,n[U].giftList[Z].productNum):n[U].giftList[Z].productNum,n[U].giftList[Z].orderRatioPrice?n[U].giftList[Z].shopCartNum=F===n[U].giftList[Z].shopCartNum?n[U].giftList[Z].maxQuotaQty:Math.min(n[U].giftList[Z].maxQuotaQty,n[U].giftList[Z].shopCartNum):n[U].giftList[Z].shopCartNum=n[U].giftList[Z].maxQuotaQty,1===n[U].chose&&(n[U].giftList[Z].selected=n[U].giftList[Z].orderRatioPrice&&n[U].giftList[Z].isHave&&2!==n[U].giftList[Z].pStatus||!n[U].giftList[Z].orderRatioPrice)}}else{n[U].active=!1,n[U].chose=0;for(var A=0;A<n[U].giftList.length;A++)n[U].giftList[A].shopCartNum=0,n[U].giftList[A].maxQuotaQty=0,n[U].giftList[A].selected=!1}n.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(W+=t.shopCartNum*t.orderRatioPrice)})}),s.keyProductPrice=Math.round(100*W)/100,s.promotionTotalPrice=W,i+=s.keyProductPrice,t+=s.promotionTotalPrice}this.promotion[e]=s}this.ifNull=o,this.pTotalPrice=t,this.pTotalPriceExclude=i,this.watchTotalPriceExclude(1),this.setDot(this)},watchTotalPriceExclude:function(t){this.totalSelected=this.productSelected&&this.promotionSelected,this.totalPriceExclude=Math.round(100*(this.pTotalPriceExclude+this.productTotalPrice))/100;for(var i=0,o=0;o<this.promotion.length;o++)if(3===this.promotion[o].type){for(var e=this.promotion[o].promotionRuleVO,s=e.rules,r=0,n=0;n<s.length;n++)if(s[n].sum<=this.totalPriceExclude){s[n].active=!0,s[n].chose=0===e.relation&&0===s[n].chose?1:s[n].chose;for(var a=0;a<s[n].giftList.length;a++){var c=Math.floor(this.totalPriceExclude/s[n].sum),p=s[n].infinite||c<=s[n].loop?c:s[n].loop,u=s[n].giftList[a].maxQuotaQty;null!==s[n].giftList[a].avaliableWithRatioQty?s[n].giftList[a].maxQuotaQty=Math.min(p*s[n].giftList[a].productNum,s[n].giftList[a].avaliableWithRatioQty):s[n].giftList[a].maxQuotaQty=p*s[n].giftList[a].productNum,s[n].giftList[a].orderRatioPrice?s[n].giftList[a].shopCartNum=u===s[n].giftList[a].shopCartNum?s[n].giftList[a].maxQuotaQty:Math.min(s[n].giftList[a].maxQuotaQty,s[n].giftList[a].shopCartNum):s[n].giftList[a].shopCartNum=s[n].giftList[a].maxQuotaQty,0===e.relation&&1===s[n].chose&&(s[n].giftList[a].selected=s[n].giftList[a].orderRatioPrice&&s[n].giftList[a].isHave&&2!==s[n].giftList[a].pStatus||!s[n].giftList[a].orderRatioPrice)}}else{s[n].active=!1,s[n].chose=0;for(var l=0;l<s[n].giftList.length;l++)s[n].giftList[l].shopCartNum=0,s[n].giftList[l].maxQuotaQty=0,s[n].giftList[l].selected=!1}var d=s.filter(function(t){return t.active}).length;if(this.promotion[o].isMust=d?1:0,d&&1===e.relation){var f=s.filter(function(t){return 2===t.chose||3===t.chose}).length;0===f&&function(){var t=0;s.forEach(function(i,o,e){i.active&&(t=i.sum>e[t].sum?o:t)});for(var i=0;i<s.length;i++)i===t?(s[i].chose=1,s[i].giftList=s[i].giftList.map(function(t){return t.selected=t.orderRatioPrice&&t.isHave&&2!==t.pStatus||!t.orderRatioPrice,t})):(s[i].chose=0,s[i].giftList=s[i].giftList.map(function(t){return t.selected=!1,t}))}()}s.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(r+=t.shopCartNum*t.orderRatioPrice)})}),this.promotion[o].promotionTotalPrice=r,i+=this.promotion[o].promotionTotalPrice}this.fullGiftPrice=i,this.totalPrice=Math.round(100*(this.pTotalPrice+this.productTotalPrice+this.fullGiftPrice))/100,this.saveCart({type:t,item:3===t?{product:this.product,promotion:this.promotion}:this.promotion})},loadQuota:function(t,i){var o=this;this.inited||(this.inited=!0,this.$tupHttp(this,"front/product/selectProductQuotaFromSolr?search="+this.promotion[t].promotionRuleVO.productList[i].pCode).then(function(e){o.inited=!1,o.promotion[t].promotionRuleVO.productList[i].mustQty=e.data.model&&e.data.model.mustQty?e.data.model.mustQty:null,o.promotion[t].promotionRuleVO.productList[i].mqq=e.data.model&&e.data.model.mqq?e.data.model.mqq:null,o.promotion[t].promotionRuleVO.productList[i].availableQty=e.data.model&&null!==e.data.model.availableQty?e.data.model.availableQty:null,o.promotion[t].isNotmm=o.promotion[t].promotionRuleVO.productList.some(function(t){return t.shopCartNum<t.mustQty||t.shopCartNum<t.mqq||null!==t.availableQty&&t.shopCartNum>t.availableQty}),o.$vux.toast.text("配置刷新成功"),o.saveCart({type:1,item:o.promotion})},function(){o.inited=!1}).catch(function(){o.inited=!1}))},checkPromotions:function(){var t=this,i=this.promotion.map(function(t){return{id:t.id,version:t.version,promotionId:t.promotionId}});if(!i.length)return void this.checkProductDownAndLack();this.$tupHttp(this,"front/promotion/checkPromotions","POST",i).then(function(i){if(i.data.model.deletes.length){var o=t.$util.deepClone(t.promotion);i.data.model.deletes.forEach(function(t){o=o.filter(function(i){return t.id!==i.id})}),t.promotion=o}i.data.model.updates.length&&(i.data.model.updates.forEach(function(i){for(var o=0;o<t.promotion.length;o++)i.id===t.promotion[o].id&&(i.promotionRuleVO.productList&&i.promotionRuleVO.productList.map(function(t){return t.isHave&&(t.selected=!0),t.mustQty&&4!==i.type&&(t.selected=!0,t.shopCartNum=t.mustQty),4===i.type&&(t.selected=!0,t.shopCartNum=t.productNum),t}),i.selected=!0,i.shopCartNum=1,i.ifEdit=!1,i.keyProductPrice=0,i.promotionTotalPrice=0,t.promotion[o]=i)}),t.$router.replace({path:"/refresh",query:{t:Date.now()}})),t.checkProductDownAndLack()})},checkProductDownAndLack:function(){var t=this,i=[],o=[];i=this.product.filter(function(t){return 2===t.pStatus}).map(function(t){return t.pCode}),o=this.product.filter(function(t){return!t.isHave}).map(function(t){return t.pCode}),this.promotion.forEach(function(t){t.promotionRuleVO.productList&&t.promotionRuleVO.productList.forEach(function(t){2===t.pStatus&&i.indexOf(t.pCode)<0&&i.push(t.pCode),!t.isHave&&o.indexOf(t.pCode)<0&&o.push(t.pCode)}),0!==t.type&&t.promotionRuleVO.rules.forEach(function(t){t.giftList.forEach(function(t){2===t.pStatus&&i.indexOf(t.pCode)<0&&i.push(t.pCode),!t.isHave&&o.indexOf(t.pCode)<0&&o.push(t.pCode)})})}),o.length||i.length?this.$tupHttp(this,"front/product/checkProductDownAndLack","POST",{inStockProductCode:o,upProductCode:i}).then(function(i){var o=i.data.model;o.inStockProductCode.length&&(t.product=t.product.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),t.promotion=t.promotion.map(function(t){return t.promotionRuleVO.productList=t.promotionRuleVO.productList.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),0!==t.type&&(t.promotionRuleVO.rules=t.promotionRuleVO.rules.map(function(t){return t.giftList=t.giftList.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),t})),t})),o.upProductCode.length&&(t.product=t.product.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),t.promotion=t.promotion.map(function(t){return t.promotionRuleVO.productList=t.promotionRuleVO.productList.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),0!==t.type&&(t.promotionRuleVO.rules=t.promotionRuleVO.rules.map(function(t){return t.giftList=t.giftList.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),t})),t})),t._initPromotion()}):this._initPromotion()},numberClick:function(t){switch(t.target.nodeName){case"path":t.target.parentNode.parentNode.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足");break;case"svg":t.target.parentNode.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足");break;case"a":t.target.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足")}},toEdit:function(){this.promotion=this.promotion.map(function(t){return t.ifEdit=!1,t}),this.product=this.product.map(function(t){return t.ifEdit=!1,t}),this.ifEdit=!this.ifEdit,this.productIfEdit=!1,this.totalEditSelected=!1},productEditClick:function(t){this.product[t].ifEdit=!this.product[t].ifEdit,this.productIfEdit=this.product.every(function(t){return t.ifEdit});var i=!this.promotion.some(function(t){return!(0!==t.type&&1!==t.type&&4!==t.type||t.isMust||t.ifEdit)});this.totalEditSelected=this.productIfEdit&&i},promotionEditClick:function(t){this.promotion[t].ifEdit=!this.promotion[t].ifEdit;var i=!this.promotion.some(function(t){return!(0!==t.type&&1!==t.type&&4!==t.type||t.isMust||t.ifEdit)});this.totalEditSelected=this.productIfEdit&&i},totalEditClick:function(){var t=!this.totalEditSelected;this.promotion=this.promotion.map(function(i){return i.ifEdit=t,i}),this.product=this.product.map(function(i){return i.ifEdit=t,i}),this.productIfEdit=t},delEdit:function(){var t=this.product.some(function(t){return t.ifEdit}),i=this.promotion.some(function(t){return t.ifEdit});t||i?this.ifRemove=!0:this.$vux.toast.text("请勾选需要删除的产品~")},onConfirm:function(){for(var t=0;t<this.product.length;t++)this.product[t].ifEdit&&!this.product[t].mustQty&&(this.product.splice(t,1),t--);for(var i=0;i<this.promotion.length;i++)0!==this.promotion[i].type&&1!==this.promotion[i].type&&4!==this.promotion[i].type||this.promotion[i].isMust||!this.promotion[i].ifEdit||(this.promotion.splice(i,1),i--);this.watchProduct(),this.watchPromotion()},productClick:function(t){this.product[t].selected=!this.product[t].selected,this.watchProduct()},changeProductNum:function(t){this.product[t].mqq&&this.product[t].shopCartNum<this.product[t].mqq&&(this.product[t].shopCartNum=0),this.watchProduct()},promotionCheck:function(t){if(!this.promotion[t].isMust){this.promotion[t].selected=!this.promotion[t].selected;for(var i=0;i<this.promotion[t].promotionRuleVO.productList.length;i++)this.promotion[t].promotionRuleVO.productList[i].selected=this.promotion[t].selected;this.watchPromotion()}},promotionClick:function(t,i){this.promotion[t].promotionRuleVO.productList[i].selected=!this.promotion[t].promotionRuleVO.productList[i].selected,this.watchPromotion()},changePromotionNum:function(t,i){"number"==typeof t&&"number"==typeof i&&this.promotion[t].promotionRuleVO.productList[i].mqq&&this.promotion[t].promotionRuleVO.productList[i].mqq>this.promotion[t].promotionRuleVO.productList[i].shopCartNum&&(this.promotion[t].promotionRuleVO.productList[i].shopCartNum=0),this.watchPromotion()},totalClick:function(){for(var t=!this.totalSelected,i=this.product,o=this.promotion,e=0,s=i.length;e<s;e++)i[e].isHave&&2!==i[e].pStatus&&!i[e].mustQty&&(i[e].selected=t);for(var r=0,n=o.length;r<n;r++){4!==o[r].type||o[r].isMust||(o[r].selected=t);for(var a=0;a<o[r].promotionRuleVO.productList.length;a++)(4!==o[r].type||4===o[r].type&&!o[r].isMust)&&o[r].promotionRuleVO.productList[a].isHave&&2!==o[r].promotionRuleVO.productList[a].pStatus&&!o[r].promotionRuleVO.productList[a].mustQty&&(o[r].promotionRuleVO.productList[a].selected=t)}this.product=i,this.promotion=o,this.watchProduct(),this.watchPromotion()},showZengPop:function(){this.needGift=this.needGiftProduct,this.ifZengPop=!0},zengPopClick:function(){this.needGift=1===this.needGift?0:1},closeZengPop:function(){this.ifZengPop=!1},confirmZeng:function(){if(this.needGiftProduct!==this.needGift){this.needGiftProduct=this.needGift;var t=h.a.get("TUP_cart");t.needGiftProduct=this.needGiftProduct,h.a.set("TUP_cart",t)}this.ifZengPop=!1},showPop:function(t,i){this.ifPop=!0,this.popupContent=this.$util.deepClone(t),this.popupIndex=i},zengClick:function(t,i){var o=this.popupContent.promotionRuleVO;if(o.rules[t].active){var e=o.rules[t];e.giftList[i].selected=!e.giftList[i].selected;var s=e.giftList.filter(function(t){return t.selected}).length;if(e.chose=0===s?2:3,1===o.relation&&3===e.chose)for(var r=0;r<o.rules.length;r++)r!==t&&(o.rules[r].chose=0,o.rules[r].giftList.forEach(function(t){t.selected=!1}))}},confirm:function(){this.ifPop=!1,this.promotion[this.popupIndex]=this.popupContent,this.watchPromotion()},closePop:function(){this.ifPop=!1},toConfirm:function(){var t=this;if(!this.inited){if(!this.totalPrice)return void this.$vux.toast.text("请选择产品~");if(this.promotion.some(function(t){return t.isNotmm}))return void this.$vux.toast.text("首订礼包有产品必订量，起订量或者配额配置有误~");this.inited=!0,this.$tupHttp(this,"front/order/order/checkOrderPlan","POST",{bookType:this.pFirstOrderDate?0:1,timeType:1}).then(function(i){i.data.model?t.$tupHttp(t,"front/systemParameters/get","POST").then(function(i){var o=t.pFirstOrderDate?i.data.model.pMinorderamount:i.data.model.firstOrderMinimum;t.totalPrice<o?(t.$vux.toast.text("订单需满"+o+"才可提交"),t.inited=!1):t.$router.push({path:"/orderConfirm"})},function(){t.inited=!1}).catch(function(){t.inited=!1}):(t.$vux.toast.text("当前不是下单时间~"),t.inited=!1)},function(){t.inited=!1}).catch(function(){t.inited=!1})}},_initPromotion:function(){this.product.length||this.promotion.length?(this.watchProduct(),this.watchPromotion()):this.ifNull=!1}},Object(m.b)(["setDot","saveCart"])),n.a,p.a,a.a,c.a,u.a,f.a,l.a,d.a,{data:function(){return{pAllowBusiness:h.a.get("TUP_pAllowBusiness"),needGiftProduct:h.a.get("TUP_cart").needGiftProduct,needGift:h.a.get("TUP_cart").needGiftProduct,totalSelected:!1,totalEditSelected:!1,product:[],promotion:[],giftProducts:[],pTotalPrice:0,pTotalPriceExclude:0,productTotalPrice:0,fullGiftPrice:0,totalPrice:0,totalPriceExclude:0,productSelected:!0,promotionSelected:!0,pFirstOrderDate:null,ifNull:!0,ifZengPop:!1,ifPop:!1,popupContent:{},popupIndex:-1,ifRemove:!1,ifNotTime:!1,delPIndex:-1,productIfEdit:!1,ifEdit:!1,inited:!1}},watch:{$route:function(t,i){"orderConfirm"===i.name&&(this.product=h.a.get("TUP_cart").product,this.promotion=h.a.get("TUP_cart").promotion,this.giftProducts=h.a.get("TUP_cart").giftProducts,this.pFirstOrderDate=h.a.get("TUP_pFirstorderDate"),this.inited=!1,this.checkPromotions())}},methods:r()({watchProduct:function(){var t=0;this.productSelected=!0;for(var i=0;i<this.product.length;i++)this.product[i].selected?t+=this.product[i].orderRatioPrice*this.product[i].shopCartNum:this.productSelected=!1,0===this.product[i].shopCartNum&&this.product.splice(i,1);this.productTotalPrice=Math.round(100*t)/100,this.watchTotalPriceExclude(3),this.setDot(this)},watchPromotion:function(){var t=0,i=0;this.promotionSelected=!0;for(var o=!1,e=0;e<this.promotion.length;e++){var s=this.promotion[e],r=s.promotionRuleVO.productList,n=s.promotionRuleVO.rules,a=s.promotionRuleVO.relation,c=0,p=0;if(0===s.type){o=!0;for(var u=0,l=0;l<r.length;l++)r[l].selected?u+=r[l].shopCartNum*r[l].orderRatioPrice:this.promotionSelected=!1;s.promotionTotalPrice=u,s.keyProductPrice=Math.round(100*u)/100,i+=s.keyProductPrice,t+=s.promotionTotalPrice}if(1===s.type){o=!0;for(var d=0,f=0;f<r.length;f++)r[f].selected?(c+=r[f].shopCartNum,p+=r[f].shopCartNum*r[f].orderRatioPrice,d+=r[f].shopCartNum*r[f].orderRatioPrice):this.promotionSelected=!1;s.keyProductPrice=Math.round(100*d)/100;for(var m=0;m<n.length;m++)if(n[m].byMoney)if(n[m].sum<=p&&n[m].min<=c)if(n[m].products.length){for(var h=0,g=0,v=0;v<n[m].products.length;v++)for(var L=0;L<r.length;L++)n[m].products[v]===r[L].pCode&&r[L].selected&&(h+=r[L].shopCartNum*r[L].orderRatioPrice,g+=r[L].shopCartNum);if(n[m].sum<=h&&n[m].min<=g){n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var x=0;x<n[m].giftList.length;x++){var C=Math.floor(h/n[m].sum),P=n[m].infinite||C<=n[m].loop?C:n[m].loop,y=n[m].giftList[x].maxQuotaQty;null!==n[m].giftList[x].avaliableWithRatioQty?n[m].giftList[x].maxQuotaQty=Math.min(P*n[m].giftList[x].productNum,n[m].giftList[x].avaliableWithRatioQty):n[m].giftList[x].maxQuotaQty=P*n[m].giftList[x].productNum,n[m].giftList[x].orderRatioPrice?n[m].giftList[x].shopCartNum=y===n[m].giftList[x].shopCartNum?n[m].giftList[x].maxQuotaQty:Math.min(n[m].giftList[x].maxQuotaQty,n[m].giftList[x].shopCartNum):n[m].giftList[x].shopCartNum=n[m].giftList[x].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[x].selected=n[m].giftList[x].orderRatioPrice&&n[m].giftList[x].isHave&&2!==n[m].giftList[x].pStatus||!n[m].giftList[x].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var w=0;w<n[m].giftList.length;w++)n[m].giftList[w].shopCartNum=0,n[m].giftList[w].maxQuotaQty=0,n[m].giftList[w].selected=!1}}else{n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var _=0;_<n[m].giftList.length;_++){var b=Math.floor(p/n[m].sum),Q=n[m].infinite||b<=n[m].loop?b:n[m].loop,N=n[m].giftList[_].maxQuotaQty;null!==n[m].giftList[_].avaliableWithRatioQty?n[m].giftList[_].maxQuotaQty=Math.min(Q*n[m].giftList[_].productNum,n[m].giftList[_].avaliableWithRatioQty):n[m].giftList[_].maxQuotaQty=Q*n[m].giftList[_].productNum,n[m].giftList[_].orderRatioPrice?n[m].giftList[_].shopCartNum=N===n[m].giftList[_].shopCartNum?n[m].giftList[_].maxQuotaQty:Math.min(n[m].giftList[_].maxQuotaQty,n[m].giftList[_].shopCartNum):n[m].giftList[_].shopCartNum=n[m].giftList[_].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[_].selected=n[m].giftList[_].orderRatioPrice&&n[m].giftList[_].isHave&&2!==n[m].giftList[_].pStatus||!n[m].giftList[_].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var k=0;k<n[m].giftList.length;k++)n[m].giftList[k].shopCartNum=0,n[m].giftList[k].maxQuotaQty=0,n[m].giftList[k].selected=!1}else if(n[m].num<=c&&n[m].min<=c)if(n[m].products.length){for(var R=0,E=0;E<n[m].products.length;E++)for(var O=0;O<r.length;O++)n[m].products[E]===r[O].pCode&&r[O].selected&&(R+=r[O].shopCartNum);if(n[m].num<=R&&n[m].min<=R){n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var S=0;S<n[m].giftList.length;S++){var T=Math.floor(R/n[m].num),V=n[m].infinite||T<=n[m].loop?T:n[m].loop,z=n[m].giftList[S].maxQuotaQty;null!==n[m].giftList[S].avaliableWithRatioQty?n[m].giftList[S].maxQuotaQty=Math.min(V*n[m].giftList[S].productNum,n[m].giftList[S].avaliableWithRatioQty):n[m].giftList[S].maxQuotaQty=V*n[m].giftList[S].productNum,n[m].giftList[S].orderRatioPrice?n[m].giftList[S].shopCartNum=z===n[m].giftList[S].shopCartNum?n[m].giftList[S].maxQuotaQty:Math.min(n[m].giftList[S].maxQuotaQty,n[m].giftList[S].shopCartNum):n[m].giftList[S].shopCartNum=n[m].giftList[S].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[S].selected=n[m].giftList[S].orderRatioPrice&&n[m].giftList[S].isHave&&2!==n[m].giftList[S].pStatus||!n[m].giftList[S].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var M=0;M<n[m].giftList.length;M++)n[m].giftList[M].shopCartNum=0,n[m].giftList[M].maxQuotaQty=0,n[m].giftList[M].selected=!1}}else{n[m].active=!0,n[m].chose=0===a&&0===n[m].chose?1:n[m].chose;for(var H=0;H<n[m].giftList.length;H++){var q=Math.floor(c/n[m].num),$=n[m].infinite||q<=n[m].loop?q:n[m].loop,D=n[m].giftList[H].maxQuotaQty;null!==n[m].giftList[H].avaliableWithRatioQty?n[m].giftList[H].maxQuotaQty=Math.min($*n[m].giftList[H].productNum,n[m].giftList[H].avaliableWithRatioQty):n[m].giftList[H].maxQuotaQty=$*n[m].giftList[H].productNum,n[m].giftList[H].orderRatioPrice?n[m].giftList[H].shopCartNum=D===n[m].giftList[H].shopCartNum?n[m].giftList[H].maxQuotaQty:Math.min(n[m].giftList[H].maxQuotaQty,n[m].giftList[H].shopCartNum):n[m].giftList[H].shopCartNum=n[m].giftList[H].maxQuotaQty,1===n[m].chose&&0===a&&(n[m].giftList[H].selected=n[m].giftList[H].orderRatioPrice&&n[m].giftList[H].isHave&&2!==n[m].giftList[H].pStatus||!n[m].giftList[H].orderRatioPrice)}}else{n[m].active=!1,n[m].chose=0;for(var G=0;G<n[m].giftList.length;G++)n[m].giftList[G].shopCartNum=0,n[m].giftList[G].maxQuotaQty=0,n[m].giftList[G].selected=!1}if(1===a){if(n.filter(function(t){return t.active}).length){0===n.filter(function(t){return 2===t.chose||3===t.chose}).length&&function(){var t=n.filter(function(t){return t.byMoney}).length,i=0;if(0===t)n.forEach(function(t,o,e){t.active&&(i=t.num>e[i].num?o:i)});else if(t===n.length)n.forEach(function(t,o,e){t.active&&(i=t.sum>e[i].sum?o:i)});else for(var o=0;o<n.length;o++)if(n[o].active){i=o;break}for(var e=0;e<n.length;e++)e===i?(n[e].chose=1,n[e].giftList=n[e].giftList.map(function(t){return t.selected=t.orderRatioPrice&&t.isHave&&2!==t.pStatus||!t.orderRatioPrice,t})):(n[e].chose=0,n[e].giftList=n[e].giftList.map(function(t){return t.selected=!1,t}))}()}}n.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(d+=t.shopCartNum*t.orderRatioPrice)})}),s.promotionTotalPrice=Math.round(100*d)/100,i+=s.keyProductPrice,t+=s.promotionTotalPrice}if(4===s.type){o=!0;for(var W=0,I=0;I<r.length;I++)r[I].selected?W+=r[I].shopCartNum*r[I].orderRatioPrice:this.promotionSelected=!1;for(var U=0;U<n.length;U++)if(s.selected){n[U].active=!0,n[U].chose=1;for(var Z=0;Z<n[U].giftList.length;Z++){var F=n[U].giftList[Z].maxQuotaQty;n[U].giftList[Z].maxQuotaQty=null!==n[U].giftList[Z].avaliableWithRatioQty?Math.min(n[U].giftList[Z].avaliableWithRatioQty,n[U].giftList[Z].productNum):n[U].giftList[Z].productNum,n[U].giftList[Z].orderRatioPrice?n[U].giftList[Z].shopCartNum=F===n[U].giftList[Z].shopCartNum?n[U].giftList[Z].maxQuotaQty:Math.min(n[U].giftList[Z].maxQuotaQty,n[U].giftList[Z].shopCartNum):n[U].giftList[Z].shopCartNum=n[U].giftList[Z].maxQuotaQty,1===n[U].chose&&(n[U].giftList[Z].selected=n[U].giftList[Z].orderRatioPrice&&n[U].giftList[Z].isHave&&2!==n[U].giftList[Z].pStatus||!n[U].giftList[Z].orderRatioPrice)}}else{n[U].active=!1,n[U].chose=0;for(var A=0;A<n[U].giftList.length;A++)n[U].giftList[A].shopCartNum=0,n[U].giftList[A].maxQuotaQty=0,n[U].giftList[A].selected=!1}n.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(W+=t.shopCartNum*t.orderRatioPrice)})}),s.keyProductPrice=Math.round(100*W)/100,s.promotionTotalPrice=W,i+=s.keyProductPrice,t+=s.promotionTotalPrice}this.promotion[e]=s}this.ifNull=o,this.pTotalPrice=t,this.pTotalPriceExclude=i,this.watchTotalPriceExclude(1),this.setDot(this)},watchTotalPriceExclude:function(t){this.totalSelected=this.productSelected&&this.promotionSelected,this.totalPriceExclude=Math.round(100*(this.pTotalPriceExclude+this.productTotalPrice))/100;for(var i=0,o=0;o<this.promotion.length;o++)if(3===this.promotion[o].type){for(var e=this.promotion[o].promotionRuleVO,s=e.rules,r=0,n=0;n<s.length;n++)if(s[n].sum<=this.totalPriceExclude){s[n].active=!0,s[n].chose=0===e.relation&&0===s[n].chose?1:s[n].chose;for(var a=0;a<s[n].giftList.length;a++){var c=Math.floor(this.totalPriceExclude/s[n].sum),p=s[n].infinite||c<=s[n].loop?c:s[n].loop,u=s[n].giftList[a].maxQuotaQty;null!==s[n].giftList[a].avaliableWithRatioQty?s[n].giftList[a].maxQuotaQty=Math.min(p*s[n].giftList[a].productNum,s[n].giftList[a].avaliableWithRatioQty):s[n].giftList[a].maxQuotaQty=p*s[n].giftList[a].productNum,s[n].giftList[a].orderRatioPrice?s[n].giftList[a].shopCartNum=u===s[n].giftList[a].shopCartNum?s[n].giftList[a].maxQuotaQty:Math.min(s[n].giftList[a].maxQuotaQty,s[n].giftList[a].shopCartNum):s[n].giftList[a].shopCartNum=s[n].giftList[a].maxQuotaQty,0===e.relation&&1===s[n].chose&&(s[n].giftList[a].selected=s[n].giftList[a].orderRatioPrice&&s[n].giftList[a].isHave&&2!==s[n].giftList[a].pStatus||!s[n].giftList[a].orderRatioPrice)}}else{s[n].active=!1,s[n].chose=0;for(var l=0;l<s[n].giftList.length;l++)s[n].giftList[l].shopCartNum=0,s[n].giftList[l].maxQuotaQty=0,s[n].giftList[l].selected=!1}var d=s.filter(function(t){return t.active}).length;if(this.promotion[o].isMust=d?1:0,d&&1===e.relation){var f=s.filter(function(t){return 2===t.chose||3===t.chose}).length;0===f&&function(){var t=0;s.forEach(function(i,o,e){i.active&&(t=i.sum>e[t].sum?o:t)});for(var i=0;i<s.length;i++)i===t?(s[i].chose=1,s[i].giftList=s[i].giftList.map(function(t){return t.selected=t.orderRatioPrice&&t.isHave&&2!==t.pStatus||!t.orderRatioPrice,t})):(s[i].chose=0,s[i].giftList=s[i].giftList.map(function(t){return t.selected=!1,t}))}()}s.forEach(function(t){1!==t.chose&&3!==t.chose||t.giftList.forEach(function(t){t.selected&&t.orderRatioPrice&&(r+=t.shopCartNum*t.orderRatioPrice)})}),this.promotion[o].promotionTotalPrice=r,i+=this.promotion[o].promotionTotalPrice}this.fullGiftPrice=i,this.totalPrice=Math.round(100*(this.pTotalPrice+this.productTotalPrice+this.fullGiftPrice))/100,this.saveCart({type:t,item:3===t?{product:this.product,promotion:this.promotion}:this.promotion})},loadQuota:function(t,i){var o=this;this.inited||(this.inited=!0,this.$tupHttp(this,"front/product/selectProductQuotaFromSolr?search="+this.promotion[t].promotionRuleVO.productList[i].pCode).then(function(e){o.inited=!1,o.promotion[t].promotionRuleVO.productList[i].mustQty=e.data.model&&e.data.model.mustQty?e.data.model.mustQty:null,o.promotion[t].promotionRuleVO.productList[i].mqq=e.data.model&&e.data.model.mqq?e.data.model.mqq:null,o.promotion[t].promotionRuleVO.productList[i].availableQty=e.data.model&&null!==e.data.model.availableQty?e.data.model.availableQty:null,o.promotion[t].isNotmm=o.promotion[t].promotionRuleVO.productList.some(function(t){return t.shopCartNum<t.mustQty||t.shopCartNum<t.mqq||null!==t.availableQty&&t.shopCartNum>t.availableQty}),o.$vux.toast.text("配置刷新成功"),o.saveCart({type:1,item:o.promotion})},function(){o.inited=!1}).catch(function(){o.inited=!1}))},checkPromotions:function(){var t=this,i=this.promotion.map(function(t){return{id:t.id,version:t.version,promotionId:t.promotionId}});if(!i.length)return void this.checkProductDownAndLack();this.$tupHttp(this,"front/promotion/checkPromotions","POST",i).then(function(i){if(i.data.model.deletes.length){var o=t.$util.deepClone(t.promotion);i.data.model.deletes.forEach(function(t){o=o.filter(function(i){return t.id!==i.id})}),t.promotion=o}i.data.model.updates.length&&(i.data.model.updates.forEach(function(i){for(var o=0;o<t.promotion.length;o++)i.id===t.promotion[o].id&&(i.promotionRuleVO.productList&&i.promotionRuleVO.productList.map(function(t){return t.isHave&&(t.selected=!0),t.mustQty&&4!==i.type&&(t.selected=!0,t.shopCartNum=t.mustQty),4===i.type&&(t.selected=!0,t.shopCartNum=t.productNum),t}),i.selected=!0,i.shopCartNum=1,i.ifEdit=!1,i.keyProductPrice=0,i.promotionTotalPrice=0,t.promotion[o]=i)}),t.$router.replace({path:"/refresh",query:{t:Date.now()}})),t.checkProductDownAndLack()})},checkProductDownAndLack:function(){var t=this,i=[],o=[];i=this.product.filter(function(t){return 2===t.pStatus}).map(function(t){return t.pCode}),o=this.product.filter(function(t){return!t.isHave}).map(function(t){return t.pCode}),this.promotion.forEach(function(t){t.promotionRuleVO.productList&&t.promotionRuleVO.productList.forEach(function(t){2===t.pStatus&&i.indexOf(t.pCode)<0&&i.push(t.pCode),!t.isHave&&o.indexOf(t.pCode)<0&&o.push(t.pCode)}),0!==t.type&&t.promotionRuleVO.rules.forEach(function(t){t.giftList.forEach(function(t){2===t.pStatus&&i.indexOf(t.pCode)<0&&i.push(t.pCode),!t.isHave&&o.indexOf(t.pCode)<0&&o.push(t.pCode)})})}),o.length||i.length?this.$tupHttp(this,"front/product/checkProductDownAndLack","POST",{inStockProductCode:o,upProductCode:i}).then(function(i){var o=i.data.model;o.inStockProductCode.length&&(t.product=t.product.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),t.promotion=t.promotion.map(function(t){return t.promotionRuleVO.productList=t.promotionRuleVO.productList.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),0!==t.type&&(t.promotionRuleVO.rules=t.promotionRuleVO.rules.map(function(t){return t.giftList=t.giftList.map(function(t){return o.inStockProductCode.indexOf(t.pCode)>=0&&(t.isHave=1),t}),t})),t})),o.upProductCode.length&&(t.product=t.product.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),t.promotion=t.promotion.map(function(t){return t.promotionRuleVO.productList=t.promotionRuleVO.productList.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),0!==t.type&&(t.promotionRuleVO.rules=t.promotionRuleVO.rules.map(function(t){return t.giftList=t.giftList.map(function(t){return o.upProductCode.indexOf(t.pCode)>=0&&(t.pStatus=1),t}),t})),t})),t._initPromotion()}):this._initPromotion()},numberClick:function(t){switch(t.target.nodeName){case"path":t.target.parentNode.parentNode.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足");break;case"svg":t.target.parentNode.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足");break;case"a":t.target.className.search("vux-number-selector-plus vux-number-disabled")>=0&&this.$vux.toast.text("配额不足")}},toEdit:function(){this.promotion=this.promotion.map(function(t){return t.ifEdit=!1,t}),this.product=this.product.map(function(t){return t.ifEdit=!1,t}),this.ifEdit=!this.ifEdit,this.productIfEdit=!1,this.totalEditSelected=!1},productEditClick:function(t){this.product[t].ifEdit=!this.product[t].ifEdit,this.productIfEdit=this.product.every(function(t){return t.ifEdit});var i=!this.promotion.some(function(t){return!(0!==t.type&&1!==t.type&&4!==t.type||t.isMust||t.ifEdit)});this.totalEditSelected=this.productIfEdit&&i},promotionEditClick:function(t){this.promotion[t].ifEdit=!this.promotion[t].ifEdit;var i=!this.promotion.some(function(t){return!(0!==t.type&&1!==t.type&&4!==t.type||t.isMust||t.ifEdit)});this.totalEditSelected=this.productIfEdit&&i},totalEditClick:function(){var t=!this.totalEditSelected;this.promotion=this.promotion.map(function(i){return i.ifEdit=t,i}),this.product=this.product.map(function(i){return i.ifEdit=t,i}),this.productIfEdit=t},delEdit:function(){var t=this.product.some(function(t){return t.ifEdit}),i=this.promotion.some(function(t){return t.ifEdit});t||i?this.ifRemove=!0:this.$vux.toast.text("请勾选需要删除的产品~")},onConfirm:function(){for(var t=0;t<this.product.length;t++)this.product[t].ifEdit&&!this.product[t].mustQty&&(this.product.splice(t,1),t--);for(var i=0;i<this.promotion.length;i++)0!==this.promotion[i].type&&1!==this.promotion[i].type&&4!==this.promotion[i].type||this.promotion[i].isMust||!this.promotion[i].ifEdit||(this.promotion.splice(i,1),i--);this.watchProduct(),this.watchPromotion()},productClick:function(t){this.product[t].selected=!this.product[t].selected,this.watchProduct()},changeProductNum:function(t){this.product[t].mqq&&this.product[t].shopCartNum<this.product[t].mqq&&(this.product[t].shopCartNum=0),this.watchProduct()},promotionCheck:function(t){if(!this.promotion[t].isMust){this.promotion[t].selected=!this.promotion[t].selected;for(var i=0;i<this.promotion[t].promotionRuleVO.productList.length;i++)this.promotion[t].promotionRuleVO.productList[i].selected=this.promotion[t].selected;this.watchPromotion()}},promotionClick:function(t,i){this.promotion[t].promotionRuleVO.productList[i].selected=!this.promotion[t].promotionRuleVO.productList[i].selected,this.watchPromotion()},changePromotionNum:function(t,i){"number"==typeof t&&"number"==typeof i&&this.promotion[t].promotionRuleVO.productList[i].mqq&&this.promotion[t].promotionRuleVO.productList[i].mqq>this.promotion[t].promotionRuleVO.productList[i].shopCartNum&&(this.promotion[t].promotionRuleVO.productList[i].shopCartNum=0),this.watchPromotion()},totalClick:function(){for(var t=!this.totalSelected,i=this.product,o=this.promotion,e=0,s=i.length;e<s;e++)i[e].isHave&&2!==i[e].pStatus&&!i[e].mustQty&&(i[e].selected=t);for(var r=0,n=o.length;r<n;r++){4!==o[r].type||o[r].isMust||(o[r].selected=t);for(var a=0;a<o[r].promotionRuleVO.productList.length;a++)(4!==o[r].type||4===o[r].type&&!o[r].isMust)&&o[r].promotionRuleVO.productList[a].isHave&&2!==o[r].promotionRuleVO.productList[a].pStatus&&!o[r].promotionRuleVO.productList[a].mustQty&&(o[r].promotionRuleVO.productList[a].selected=t)}this.product=i,this.promotion=o,this.watchProduct(),this.watchPromotion()},showZengPop:function(){this.needGift=this.needGiftProduct,this.ifZengPop=!0},zengPopClick:function(){this.needGift=1===this.needGift?0:1},closeZengPop:function(){this.ifZengPop=!1},confirmZeng:function(){if(this.needGiftProduct!==this.needGift){this.needGiftProduct=this.needGift;var t=h.a.get("TUP_cart");t.needGiftProduct=this.needGiftProduct,h.a.set("TUP_cart",t)}this.ifZengPop=!1},showPop:function(t,i){this.ifPop=!0,this.popupContent=this.$util.deepClone(t),this.popupIndex=i},zengClick:function(t,i){var o=this.popupContent.promotionRuleVO;if(o.rules[t].active){var e=o.rules[t];e.giftList[i].selected=!e.giftList[i].selected;var s=e.giftList.filter(function(t){return t.selected}).length;if(e.chose=0===s?2:3,1===o.relation&&3===e.chose)for(var r=0;r<o.rules.length;r++)r!==t&&(o.rules[r].chose=0,o.rules[r].giftList.forEach(function(t){t.selected=!1}))}},confirm:function(){this.ifPop=!1,this.promotion[this.popupIndex]=this.popupContent,this.watchPromotion()},closePop:function(){this.ifPop=!1},toConfirm:function(){var t=this;if(!this.inited){if(!this.totalPrice)return void this.$vux.toast.text("请选择产品~");if(this.promotion.some(function(t){return t.isNotmm}))return void this.$vux.toast.text("首订礼包有产品必订量，起订量或者配额配置有误~");this.inited=!0,this.$tupHttp(this,"front/order/order/checkOrderPlan","POST",{bookType:this.pFirstOrderDate?0:1,timeType:1}).then(function(i){i.data.model?t.$tupHttp(t,"front/systemParameters/get","POST").then(function(i){var o=t.pFirstOrderDate?i.data.model.pMinorderamount:i.data.model.firstOrderMinimum;t.totalPrice<o?(t.$vux.toast.text("订单需满"+o+"才可提交"),t.inited=!1):t.$router.push({path:"/orderConfirm"})},function(){t.inited=!1}).catch(function(){t.inited=!1}):(t.$vux.toast.text("当前不是下单时间~"),t.inited=!1)},function(){t.inited=!1}).catch(function(){t.inited=!1})}},_initPromotion:function(){this.product.length||this.promotion.length?(this.watchProduct(),this.watchPromotion()):this.ifNull=!1}},Object(m.b)(["setDot","saveCart"])),created:function(){var t=this;this.product=h.a.get("TUP_cart").product,this.promotion=h.a.get("TUP_cart").promotion,this.giftProducts=h.a.get("TUP_cart").giftProducts,this.pFirstOrderDate=h.a.get("TUP_pFirstorderDate"),this.$tupHttp(this,"front/order/order/checkOrderPlan","POST",{bookType:this.pFirstOrderDate?0:1,timeType:0}).then(function(i){i.data.model?t.checkPromotions():t.ifNotTime=!0})},components:{Group:n.a,XButton:p.a,XHeader:a.a,CheckIcon:c.a,XNumber:u.a,Scroll:f.a,Popup:l.a,Confirm:d.a}}),v=function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("div",{staticClass:"cart-wrapper"},[o("x-header",{attrs:{"left-options":{backText:""}}},[t._v("购物车\n    "),o("div",{directives:[{name:"show",rawName:"v-show",value:(t.ifNull||t.product.length)&&!t.ifNotTime,expression:"(ifNull || product.length) && !ifNotTime"}],attrs:{slot:"right"},on:{click:t.toEdit},slot:"right"},[t._v(t._s(t.ifEdit?"完成":"编辑"))])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.ifNotTime,expression:"!ifNotTime"}],staticClass:"cart-content"},[o("div",[null===t.pFirstOrderDate?o("div",{staticClass:"new-tip"},[t._v("Hi ,欢迎您成为特百惠专卖店！赶紧订购以下首订礼包，立马迎接第一笔销售订单！")]):t._e(),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.product.length,expression:"product.length"}],staticClass:"goods-wrapper goods-product"},[t._m(0),t._v(" "),t._l(t.product,function(i,e){return o("div",{staticClass:"goods-item-wrapper"},[!i.isHave||2===i.pStatus||i.mustQty?o("check-icon",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],attrs:{value:i.selected}}):o("check-icon",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],attrs:{value:i.selected},on:{"update:value":function(o){return t.$set(i,"selected",o)}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.productClick(e)}}})])],2),t._v(" "),o("check-icon",{directives:[{name:"show",rawName:"v-show",value:t.ifEdit,expression:"ifEdit"}],class:{"opacity-0":i.mustQty},attrs:{value:i.ifEdit},on:{"update:value":function(o){return t.$set(i,"ifEdit",o)}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.productEditClick(e)}}})])],2),t._v(" "),o("div",{staticClass:"goods-img"},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:i.pPicLocations?i.pPicLocations[0]+"!90":"",expression:"item.pPicLocations ? item.pPicLocations[0] + '!90' : ''"}],key:i.pPicLocations?i.pPicLocations[0]:""}),t._v(" "),i.isHave?2===i.pStatus?o("i",[t._v("下架")]):t._e():o("i",[t._v("缺货")])]),t._v(" "),o("div",{staticClass:"goods-content",class:{"vux-1px-b":e!==t.product.length-1}},[o("div",{staticClass:"goods-title"},[i.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v("\n              "+t._s(i.pCode)+"-"+t._s(i.pName)+"\n            ")]),t._v(" "),null!==i.availableQty?o("div",{staticClass:"goods-avail"},[t._v(t._s(1===i.quotaType?"产品":0===i.quotaType?"门店":"")+"配额："+t._s(i.availableQty))]):t._e(),t._v(" "),o("div",{staticClass:"goods-price"},[t._v("￥"),o("span",[t._v(t._s(t.$util.formatThousand(i.orderRatioPrice)))]),t._v("元/"+t._s(i.orderUnit)),o("span",{staticStyle:{"font-size":"12px"}},[t._v("("+t._s(i.orderRatio)+"件)")]),t._v(" "),i.isHave&&2!==i.pStatus&&!t.ifEdit?o("x-number",{staticClass:"goods-num-edit",attrs:{fillable:0!==i.availableQty,value:i.shopCartNum,step:i.ration,max:null!==i.availableQty?i.availableQty:1e4,min:i.mustQty,width:"38px","button-style":"round"},on:{"on-change":function(i){return t.changeProductNum(e)}},nativeOn:{click:function(i){return t.numberClick(i)}},model:{value:i.shopCartNum,callback:function(o){t.$set(i,"shopCartNum",o)},expression:"item.shopCartNum"}}):o("span",{staticClass:"goods-num"},[t._v("X "+t._s(i.shopCartNum))])],1)])],1)}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"goods-total vux-1px-t"},[o("span",{staticClass:"goods-m"},[t._v("小计："),o("span",[t._v("￥"+t._s(t.$util.formatThousand(t.productTotalPrice)))])])])],2),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.promotion.length,expression:"promotion.length"}],staticClass:"goods-wrapper"},t._l(t.promotion,function(i,e){return o("div",{staticClass:"goods-div",class:{hidden:3===i.type&&!i.isMust}},[o("div",{staticClass:"goods-intro"},[0!==i.type&&1!==i.type&&4!==i.type||i.isMust?t._e():o("check-icon",{directives:[{name:"show",rawName:"v-show",value:t.ifEdit,expression:"ifEdit"}],attrs:{value:i.ifEdit},on:{"update:value":function(o){return t.$set(i,"ifEdit",o)}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.promotionEditClick(e)}}})])],2),t._v(" "),4===i.type?o("check-icon",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],attrs:{value:i.selected},on:{"update:value":function(o){return t.$set(i,"selected",o)}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.promotionCheck(e)}}})])],2):t._e(),t._v(" "),0===i.type?o("i",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"icon-zhe"},[t._v("优惠")]):t._e(),t._v(" "),1===i.type?o("i",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"icon-zhe"},[t._v("买赠")]):t._e(),t._v(" "),3===i.type?o("i",{staticClass:"icon-zhe"},[t._v("满单")]):t._e(),t._v(" "),4===i.type?o("span",{staticClass:"goods-intro-text",class:{"vux-1px-b":3!==i.type}},[o("span",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"zeng"},[t._v("首订礼包")]),t._v("\n              "+t._s(i.title)+"\n            ")]):o("div",{staticClass:"goods-intro-text",class:{"vux-1px-b":3!==i.type}},[t._v(t._s(i.title))])],1),t._v(" "),t._l(i.promotionRuleVO.productList,function(s,r){return 3!==i.type?o("div",{staticClass:"goods-item-wrapper"},[4!==i.type?o("span",[!s.isHave||2===s.pStatus||s.mustQty?o("check-icon",{class:{"opacity-0":t.ifEdit},attrs:{value:s.selected}}):o("check-icon",{class:{"opacity-0":t.ifEdit},attrs:{value:s.selected},on:{"update:value":function(i){return t.$set(s,"selected",i)}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.promotionClick(e,r)}}})])],2)],1):o("check-icon",{class:{"opacity-0":!0},attrs:{value:s.selected}}),t._v(" "),o("div",{staticClass:"goods-img"},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s.pPicLocations?s.pPicLocations[0]+"!90":"",expression:"i.pPicLocations ? i.pPicLocations[0] + '!90' : ''"}],key:s.pPicLocations?s.pPicLocations[0]:""}),t._v(" "),s.isHave?2===s.pStatus?o("i",[t._v("下架")]):t._e():o("i",[t._v("缺货")])]),t._v(" "),o("div",{staticClass:"goods-content",class:{"vux-1px-b":r!==i.promotionRuleVO.productList.length-1}},[o("div",{staticClass:"goods-title"},[s.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v("\n                "+t._s(s.pCode)+"-"+t._s(s.pName)+"\n              ")]),t._v(" "),null!==s.availableQty?o("div",{staticClass:"goods-avail"},[t._v(t._s(1===s.quotaType?"产品":0===s.quotaType?"门店":"")+"配额："+t._s(s.availableQty))]):t._e(),t._v(" "),(s.shopCartNum<s.mustQty||s.shopCartNum<s.mqq||null!==s.availableQty&&s.shopCartNum>s.availableQty)&&4===i.type?o("div",{staticClass:"goods-avail"},[s.mqq?o("span",[t._v("最低定量："+t._s(s.mqq))]):t._e(),t._v(" "),s.mqq&&s.mustQty?o("span",[t._v(",")]):t._e(),t._v(" "),s.mustQty?o("span",[t._v("必定量: "+t._s(s.mustQty))]):t._e(),t._v(" "),o("i",{staticClass:"refresh-btn",class:{"m-left":!s.mqq&&!s.mustQty},on:{click:function(i){return t.loadQuota(e,r)}}},[t._v("刷新配置")])]):t._e(),t._v(" "),o("div",{staticClass:"goods-price"},[t._v("￥"),o("span",[t._v(t._s(t.$util.formatThousand(s.orderRatioPrice)))]),t._v("元/"+t._s(s.orderUnit)),o("span",{directives:[{name:"show",rawName:"v-show",value:4!==i.type,expression:"item.type !== 4"}],staticStyle:{"font-size":"12px"}},[t._v("("+t._s(s.orderRatio)+"件)")]),t._v(" "),s.isHave&&2!==s.pStatus&&!t.ifEdit&&4!==i.type?o("x-number",{staticClass:"goods-num-edit",attrs:{fillable:0!==s.availableQty,step:s.mqq&&0===s.shopCartNum?s.mqq:s.ration,min:s.mustQty,max:i.promotionRuleVO.isGiftPack&&s.mustQty?s.mustQty:null!==s.availableQty?s.availableQty:1e4,width:"38px","button-style":"round"},on:{"on-change":function(i){return t.changePromotionNum(e,r)}},nativeOn:{click:function(i){return t.numberClick(i)}},model:{value:s.shopCartNum,callback:function(i){t.$set(s,"shopCartNum",i)},expression:"i.shopCartNum"}}):o("span",{staticClass:"goods-num"},[t._v("X "+t._s(s.shopCartNum))])],1)])],1):t._e()}),t._v(" "),0!==i.type&&i.promotionRuleVO.rules.length?o("div",{staticClass:"goods-cu-wrapper vux-1px-t"},[o("div",{staticClass:"goods-cu-title"},[0!==i.type?o("p",[t._v("满足促销条件，可享受赠送或换购产品优惠")]):t._e(),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],on:{click:function(o){return t.showPop(i,e)}}},[t._v("查看"),o("i",{staticClass:"icon-back-"})])]),t._v(" "),o("div",{staticClass:"goods-cu-content"},[o("div",{staticStyle:{"padding-bottom":"6px"}},t._l(i.promotionRuleVO.rules,function(i,e){return 1===i.chose||3===i.chose?o("ul",t._l(i.giftList,function(i,e){return i.selected&&!i.orderRatioPrice?o("li",{staticStyle:{"padding-right":".25rem"}},[o("span",{staticClass:"goods-name"},[i.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v(" "),o("span",{staticClass:"zeng"},[t._v("赠送")]),t._v("\n                      "+t._s(i.pCode)+"-"+t._s(i.pName)+"\n                    ")]),t._v(" "),o("span",{staticClass:"goods-num"},[t._v("X "+t._s(i.shopCartNum))])]):t._e()}),0):t._e()}),0),t._v(" "),t._l(i.promotionRuleVO.rules,function(i,e){return 1===i.chose||3===i.chose?o("ul",t._l(i.giftList,function(i,e){return i.selected&&i.orderRatioPrice?o("li",[o("div",{staticClass:"goods-item-wrapper goods-item-small vux-1px-t"},[o("div",{staticClass:"goods-img"},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:i.pPicLocations?i.pPicLocations[0]+"!90":"",expression:"m.pPicLocations ? m.pPicLocations[0] + '!90' : ''"}],key:i.pPicLocations?i.pPicLocations[0]:""}),t._v(" "),i.isHave?2===i.pStatus?o("i",[t._v("下架")]):t._e():o("i",[t._v("缺货")])]),t._v(" "),o("div",{staticClass:"goods-content"},[o("div",{staticClass:"goods-title",staticStyle:{"padding-right":"0"}},[i.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v(" "),o("span",{staticClass:"zeng"},[t._v("换购")]),t._v("\n                        "+t._s(i.pCode)+"-"+t._s(i.pName)+"\n                      ")]),t._v(" "),null!==i.avaliableWithRatioQty?o("div",{staticClass:"goods-avail"},[t._v(t._s(1===i.quotaType?"产品":0===i.quotaType?"门店":"")+"配额："+t._s(i.avaliableWithRatioQty))]):t._e(),t._v(" "),o("div",{staticClass:"goods-price"},[t._v("￥"),o("span",[t._v(t._s(t.$util.formatThousand(i.orderRatioPrice)))]),t._v("元/"+t._s(i.orderSmallUnit)),o("span",{staticStyle:{"font-size":"12px"}},[t._v("("+t._s(i.orderRatio)+"件)")]),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:t.ifEdit,expression:"ifEdit"}],staticClass:"goods-num",staticStyle:{"padding-right":".25rem"}},[t._v("X "+t._s(i.shopCartNum))]),t._v(" "),o("x-number",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"goods-num-edit",staticStyle:{"padding-right":".12rem"},attrs:{fillable:0!==i.maxQuotaQty,value:i.shopCartNum,step:i.ration,max:i.maxQuotaQty,min:0,width:"38px","button-style":"round"},on:{"on-change":t.changePromotionNum},model:{value:i.shopCartNum,callback:function(o){t.$set(i,"shopCartNum",o)},expression:"m.shopCartNum"}})],1)])])]):t._e()}),0):t._e()})],2)]):t._e(),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"goods-total vux-1px-t"},[o("span",{staticClass:"goods-m"},[t._v("小计："),o("span",[t._v("￥"+t._s(t.$util.formatThousand(i.promotionTotalPrice))+"\n              "),i.promotionTotalPrice-i.keyProductPrice?o("span",{staticStyle:{"font-weight":"normal","font-size":"11px",color:"rgb(155,155,155)"}},[t._v("(含换购"+t._s(Math.round(100*(i.promotionTotalPrice-i.keyProductPrice))/100)+"元)")]):t._e()])])])],2)}),0),t._v(" "),t.giftProducts.length?o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifNull||t.product.length,expression:"ifNull || product.length"}],staticClass:"goods-wrapper"},[o("div",{staticClass:"goods-div"},[o("div",{staticClass:"goods-intro"},[o("i",{staticClass:"icon-zhe"},[t._v("赠送")]),t._v(" "),o("div",{staticClass:"goods-intro-text"},[t._v("已满足指定赠送")]),t._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!t.ifEdit,expression:"!ifEdit"}],staticClass:"zeng-more",on:{click:t.showZengPop}},[t._v("查看"),o("i",{staticClass:"icon-back-"})])]),t._v(" "),o("div",{staticClass:"goods-cu-content vux-1px-t",staticStyle:{"margin-left":".7rem","padding-top":"8px","padding-bottom":"8px"}},[o("ul",{directives:[{name:"show",rawName:"v-show",value:1===t.needGiftProduct,expression:"needGiftProduct === 1"}]},t._l(t.giftProducts,function(i,e){return o("li",{staticStyle:{"padding-right":".25rem"}},[o("span",{staticClass:"goods-name"},[i.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v(" "),o("span",{staticClass:"zeng"},[t._v("赠送")]),t._v("\n                  "+t._s(i.pCode)+"-"+t._s(i.pName)+"\n                ")]),t._v(" "),o("span",{staticClass:"goods-num"},[t._v("X "+t._s(i.shopCartNum))])])}),0)])])]):t._e()])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.ifNull&&!t.product.length&&!t.ifNotTime,expression:"!ifNull && !product.length && !ifNotTime"}],staticClass:"no-result"},[o("i",{staticClass:"icon-no"}),t._v(" "),o("p",[t._v("购物车空空如也~")])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifNotTime,expression:"ifNotTime"}],staticClass:"no-result"},[o("i",{staticClass:"icon-no"}),t._v(" "),o("p",[t._v("当前为非下单时间，购物车暂时无法查看")])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:(t.ifNull||t.product.length)&&!t.ifEdit&&!t.ifNotTime,expression:"(ifNull || product.length) && !ifEdit && !ifNotTime"}],staticClass:"footer-content vux-1px-t"},[o("check-icon",{attrs:{value:t.totalSelected},on:{"update:value":function(i){t.totalSelected=i}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:t.totalClick}})])],2),t._v("全选\n    "),o("div",{staticClass:"total-content"},[o("span",{staticClass:"total"},[t._v("合计金额："),o("span",[t._v("￥"+t._s(t.$util.formatThousand(t.totalPrice)))])]),t._v(" "),t.pAllowBusiness?o("a",{directives:[{name:"track-event",rawName:"v-track-event",value:"105,购物车-点击结算,0",expression:"'105,购物车-点击结算,0'"}],staticClass:"count-btn",on:{click:t.toConfirm}},[t._v("结算")]):o("a",{staticClass:"disabled-btn"},[t._v("停用下单")])])],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.ifEdit,expression:"ifEdit"}],staticClass:"footer-content vux-1px-t"},[o("check-icon",{attrs:{value:t.totalEditSelected},on:{"update:value":function(i){t.totalEditSelected=i}}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:t.totalEditClick}})])],2),t._v("全选\n    "),o("div",{staticClass:"total-content"},[o("a",{staticClass:"count-btn",staticStyle:{"background-color":"#ee3939"},on:{click:t.delEdit}},[t._v("删除")])])],1),t._v(" "),t.ifPop?o("popup",{staticClass:"popup",attrs:{position:"bottom","hide-on-blur":!1},model:{value:t.ifPop,callback:function(i){t.ifPop=i},expression:"ifPop"}},[o("div",{staticClass:"popup-header vux-1px-b"},[o("p",{staticClass:"popup-title"},[t._v("促销产品"),o("span",[t._v(t._s(0===t.popupContent.promotionRuleVO.relation?"可选择多个促销条件":"仅能选择其中一个促销条件"))])]),t._v(" "),o("i",{staticClass:"icon-close",on:{click:t.closePop}})]),t._v(" "),o("div",{staticClass:"popup-content"},[o("ul",t._l(t.popupContent.promotionRuleVO.rules,function(i,e){return o("li",{class:{"vux-1px-b":e!==t.popupContent.promotionRuleVO.rules.length-1,"dis-active":!i.active}},[i.giftList.length?o("div",[1===t.popupContent.type?o("p",{staticClass:"item-desc"},[t._v("买满"+t._s(i.byMoney?"金额"+i.sum+"元":"产品共"+i.num+"份")+"，享受赠送或换购产品优惠，"+t._s(i.infinite?"不限次数":"限"+i.loop+"次"))]):t._e(),t._v(" "),3===t.popupContent.type?o("p",{staticClass:"item-desc"},[t._v("单笔订单满"+t._s(i.sum)+"元，享受赠送或换购产品优惠，"+t._s(i.infinite?"不限次数":"限"+i.loop+"次"))]):t._e(),t._v(" "),t._l(i.giftList,function(s,r){return o("div",{staticClass:"goods-item-wrapper goods-item-small"},[s.isHave&&2!==s.pStatus?o("check-icon",{attrs:{value:s.selected}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:function(i){return t.zengClick(e,r)}}})])],2):o("check-icon",{attrs:{value:s.selected}}),t._v(" "),o("div",{staticClass:"goods-img"},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:s.pPicLocations?s.pPicLocations[0]+"!90":"",expression:"i.pPicLocations ? i.pPicLocations[0] + '!90' : ''"}],key:s.pPicLocations?s.pPicLocations[0]:""}),t._v(" "),s.isHave?2===s.pStatus?o("i",[t._v("下架")]):t._e():o("i",[t._v("缺货")])]),t._v(" "),o("div",{staticClass:"goods-content",class:{"vux-1px-b":r!==i.giftList.length-1}},[o("div",{staticClass:"goods-title"},[s.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v(" "),o("span",{staticClass:"zeng"},[t._v(t._s(s.orderRatioPrice?"换购":"赠送"))]),t._v("\n                  "+t._s(s.pCode)+"-"+t._s(s.pName)+"\n                ")]),t._v(" "),null!==s.avaliableWithRatioQty?o("div",{staticClass:"goods-avail"},[t._v(t._s(1===s.quotaType?"产品":0===s.quotaType?"门店":"")+"配额："+t._s(s.avaliableWithRatioQty))]):t._e(),t._v(" "),o("div",{staticClass:"goods-price"},[t._v("￥"),o("span",[t._v(t._s(t.$util.formatThousand(s.orderRatioPrice)))]),t._v("元/"+t._s(s.orderSmallUnit)),o("span",{staticStyle:{"font-size":"12px"}},[t._v("("+t._s(s.orderRatio)+"件)")]),t._v(" "),s.orderRatioPrice&&0!==i.chose&&2!==i.chose?o("x-number",{staticClass:"goods-num-edit",attrs:{fillable:"",value:s.shopCartNum,step:s.ration,max:s.maxQuotaQty,min:0,width:"38px","button-style":"round"},model:{value:s.shopCartNum,callback:function(i){t.$set(s,"shopCartNum",i)},expression:"i.shopCartNum"}}):o("span",{staticClass:"goods-num"},[t._v("X "+t._s(s.shopCartNum))])],1),t._v(" "),s.remark&&4===t.popupContent.type?o("div",{staticClass:"goods-remark"},[t._v("备注："+t._s(s.remark))]):t._e()])],1)})],2):t._e()])}),0)]),t._v(" "),o("div",{staticClass:"popup-btn",on:{click:t.confirm}},[t._v("确定")])]):t._e(),t._v(" "),t.ifZengPop?o("popup",{staticClass:"popup zeng-popup",attrs:{position:"bottom","hide-on-blur":!1},model:{value:t.ifZengPop,callback:function(i){t.ifZengPop=i},expression:"ifZengPop"}},[o("div",{staticClass:"popup-header vux-1px-b"},[o("check-icon",{staticStyle:{position:"absolute",left:"18px"},attrs:{value:1===t.needGift}},[t._t("default",[o("a",{staticClass:"check-slot",on:{click:t.zengPopClick}})])],2),t._v(" "),o("p",{staticClass:"popup-title",staticStyle:{"text-indent":"22px"}},[t._v("指定赠送产品")]),t._v(" "),o("i",{staticClass:"icon-close",on:{click:t.closeZengPop}})],1),t._v(" "),o("div",{staticClass:"popup-content"},[o("ul",t._l(t.giftProducts,function(i,e){return o("li",[o("div",{staticClass:"goods-item-wrapper goods-item-small"},[o("div",{staticClass:"goods-img"},[o("img",{directives:[{name:"lazy",rawName:"v-lazy",value:i.pPicLocations?i.pPicLocations[0]+"!90":"",expression:"item.pPicLocations ? item.pPicLocations[0] + '!90' : ''"}],key:i.pPicLocations?i.pPicLocations[0]:""})]),t._v(" "),o("div",{staticClass:"goods-content",class:{"vux-1px-b":e!==i.length-1}},[o("div",{staticClass:"goods-title"},[i.isDiscount?o("span",{staticClass:"zeng"},[t._v("打折")]):o("span",{staticClass:"zeng"},[t._v("不打折")]),t._v(" "),o("span",{staticClass:"zeng"},[t._v("赠送")]),t._v("\n                "+t._s(i.pCode)+"-"+t._s(i.pName)+"\n              ")]),t._v(" "),null!==i.avaliableWithRatioQty?o("div",{staticClass:"goods-avail"},[t._v(t._s(1===i.quotaType?"产品":0===i.quotaType?"门店":"")+"配额："+t._s(i.avaliableWithRatioQty))]):t._e(),t._v(" "),o("div",{staticClass:"goods-price"},[t._v("￥"),o("span",[t._v("0")]),t._v("元/"+t._s(i.orderSmallUnit)),o("span",{staticStyle:{"font-size":"12px"}},[t._v("("+t._s(i.orderRatio)+"件)")]),t._v(" "),o("span",{staticClass:"goods-num"},[t._v("X "+t._s(i.shopCartNum))])])])])])}),0)]),t._v(" "),o("div",{staticClass:"popup-btn",on:{click:t.confirmZeng}},[t._v("确定")])]):t._e(),t._v(" "),o("confirm",{attrs:{title:"所选产品将会被移除购物车，是否继续？"},on:{"on-confirm":t.onConfirm},model:{value:t.ifRemove,callback:function(i){t.ifRemove=i},expression:"ifRemove"}}),t._v(" "),o("router-view")],1)},L=[function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("div",{staticClass:"goods-intro"},[o("div",{staticClass:"goods-intro-text vux-1px-b"},[t._v("常规产品")])])}];v._withStripped=!0;var x={render:v,staticRenderFns:L},C=x,P=!1,y=o("VU/8"),w=e,_=y(g,C,!1,w,null,null);_.options.__file="src/components/shopping/shoppingCart.vue";i.default=_.exports},zmYn:function(t,i,o){i=t.exports=o("FZ+f")(!1),i.push([t.i,"\n.cart-wrapper .vux-header {\n  width: 100%;\n}\n.cart-wrapper .cart-content {\n  position: absolute;\n  top: 44px;\n  bottom: 45px;\n  width: 100%;\n  overflow-y: scroll;\n  overflow-x: hidden;\n}\n.cart-wrapper .cart-content .new-tip {\n  font-size: 13px;\n  padding: 8px;\n  margin-bottom: 5px;\n  background-color: #fffbec;\n  color: #ec6868;\n}\n.cart-wrapper .cart-content .goods-wrapper.goods-product {\n  margin: 5px 0;\n  background-color: #fff;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-div {\n  margin: 5px 0;\n  background-color: #fff;\n}\n.cart-wrapper .cart-content .goods-wrapper .hidden {\n  display: none;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: relative;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro .check-slot {\n  position: absolute;\n  top: -15px;\n  width: 28px;\n  height: 40px;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro .vux-check-icon {\n  position: absolute;\n  top: .25rem;\n  left: .12rem;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro .icon-zhe {\n  background-color: #ec6868;\n  color: #fff;\n  padding: 0 3px;\n  font-size: 10px;\n  line-height: 15px;\n  border-radius: 0 5px 5px 0;\n  left: 0;\n  top: 14px;\n  position: absolute;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro .goods-intro-text {\n  margin: .25rem 0 0 .7rem;\n  padding: 0 .8rem .25rem 0;\n  width: 100%;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-intro .icon-del {\n  color: #ef3939;\n  position: absolute;\n  right: .2rem;\n  top: 0;\n  padding: .3rem 0;\n  display: inline-block;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-wrapper {\n  margin-left: .7rem;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-wrapper .goods-cu-title {\n  line-height: 34px;\n  position: relative;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-wrapper .goods-cu-title span {\n  position: absolute;\n  right: .2rem;\n  top: 0;\n  padding-left: .5rem;\n  color: #ec6868;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-content {\n  margin-top: -5px;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-content li {\n  list-style: none;\n  color: #9b9b9b;\n  line-height: 20px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-content li .goods-name {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-cu-content li .goods-num {\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 15%;\n          flex: 0 0 15%;\n  text-align: right;\n}\n.cart-wrapper .cart-content .goods-wrapper .zeng-more {\n  position: absolute;\n  right: .2rem;\n  top: .25rem;\n  padding-left: .5rem;\n  color: #ec6868;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-total {\n  font-size: 14px;\n  height: .9rem;\n  line-height: .9rem;\n  margin-left: .3rem;\n  padding-right: .3rem;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-total .goods-m span {\n  font-weight: bold;\n  color: #ec6868;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-total .goods-btn {\n  float: right;\n}\n.cart-wrapper .cart-content .goods-wrapper .goods-total .goods-btn a {\n  border: 1px solid #9b9b9b;\n  border-radius: 2.5px;\n  line-height: 22px;\n  padding: 0 10px;\n  margin-left: 9px;\n}\n.cart-wrapper .zeng {\n  font-size: 10px;\n  font-weight: normal;\n  display: inline-block;\n  color: #fff;\n  padding: 0 3px;\n  background-color: #ec6868;\n  border-radius: 2.5px;\n  margin-right: 2px;\n  line-height: 14px;\n  height: 14px;\n}\n.cart-wrapper .no-result {\n  text-align: center;\n  position: absolute;\n  width: 100%;\n  top: 35%;\n  color: #c9c9c9;\n}\n.cart-wrapper .no-result i {\n  font-size: 90px;\n}\n.cart-wrapper .no-result p {\n  font-size: 15px;\n}\n.cart-wrapper .footer-content {\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  font-size: 14px;\n  height: 45px;\n  line-height: 45px;\n  background-color: #fff;\n}\n.cart-wrapper .footer-content .check-slot {\n  position: absolute;\n  bottom: 0;\n  width: 28px;\n  height: 45px;\n}\n.cart-wrapper .footer-content .total-content {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.cart-wrapper .footer-content .total-content .total {\n  font-weight: bold;\n}\n.cart-wrapper .footer-content .total-content .total span {\n  color: #ec6868;\n  font-size: 15px;\n}\n.cart-wrapper .footer-content .total-content .disabled-btn {\n  color: #fff;\n  background-color: #9b9b9b;\n  display: inline-block;\n  width: 2.2rem;\n  text-align: center;\n  margin-left: .2rem;\n}\n.cart-wrapper .footer-content .total-content .count-btn {\n  color: #fff;\n  background-color: #ffc600;\n  display: inline-block;\n  width: 2.2rem;\n  text-align: center;\n  margin-left: .2rem;\n}\n.cart-wrapper .weui-icon-circle,\n.cart-wrapper .weui-icon-success {\n  font-size: 20px;\n}\n.cart-wrapper .opacity-0 {\n  opacity: 0;\n}\n.cart-wrapper .goods-item-wrapper {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  padding: .15rem 0 0 .15rem;\n  position: relative;\n  width: 100%;\n}\n.cart-wrapper .goods-item-wrapper .weui-icon {\n  margin-top: .5rem;\n}\n.cart-wrapper .goods-item-wrapper .check-slot {\n  position: absolute;\n  bottom: 32px;\n  width: 28px;\n  height: 45px;\n  left: .15rem;\n}\n.cart-wrapper .goods-item-wrapper .goods-img {\n  width: 1.45rem;\n  height: 1.45rem;\n  border-radius: .1rem;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 1.45rem;\n          flex: 0 0 1.45rem;\n  margin-top: .06rem;\n  position: relative;\n  text-align: center;\n  line-height: 1.45rem;\n}\n.cart-wrapper .goods-item-wrapper .goods-img img {\n  display: inline-block;\n  vertical-align: middle;\n  max-width: 100%;\n  max-height: 100%;\n}\n.cart-wrapper .goods-item-wrapper .goods-img i {\n  position: absolute;\n  text-align: center;\n  background-color: rgba(204, 204, 204, 0.6);\n  font-style: normal;\n  display: block;\n  width: 100%;\n  height: 100%;\n  line-height: 1.45rem;\n  font-size: 14px;\n  font-weight: bold;\n  border-radius: 50%;\n  top: 0;\n}\n.cart-wrapper .goods-item-wrapper .goods-content {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  position: relative;\n  padding-bottom: .2rem;\n  margin-left: .16rem;\n  min-height: 1.5rem;\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.cart-wrapper .goods-item-wrapper .goods-title {\n  font-size: 14px;\n  color: #343434;\n  font-weight: bold;\n  padding-right: .2rem;\n  overflow: hidden;\n  word-break: break-all;\n  -webkit-line-clamp: 2;\n  display: -webkit-box;\n  text-overflow: ellipsis;\n  -webkit-box-orient: vertical;\n}\n.cart-wrapper .goods-item-wrapper .goods-avail {\n  color: #9b9b9b;\n  margin-top: 2px;\n}\n.cart-wrapper .goods-item-wrapper .refresh-btn {\n  color: #ec6868;\n  border: 1px solid #ec6868;\n  border-radius: 5px;\n  font-style: normal;\n  padding: 2px 6px;\n  margin-left: 6px;\n}\n.cart-wrapper .goods-item-wrapper .refresh-btn.m-left {\n  margin-left: 0;\n}\n.cart-wrapper .goods-item-wrapper .goods-price {\n  font-size: 13px;\n  color: #ec6868;\n  position: relative;\n  margin-top: 2px;\n}\n.cart-wrapper .goods-item-wrapper .goods-price span {\n  font-size: 15px;\n}\n.cart-wrapper .goods-item-wrapper .goods-price .goods-num {\n  font-size: 12px;\n  position: absolute;\n  right: .4rem;\n  top: 4px;\n  color: #9b9b9b;\n}\n.cart-wrapper .goods-item-wrapper .goods-num-edit {\n  position: absolute;\n  top: 1px;\n  right: .25rem;\n  padding-right: 0;\n}\n.cart-wrapper .goods-item-wrapper .goods-num-edit.weui-cell {\n  padding: 0;\n}\n.cart-wrapper .goods-item-wrapper .goods-num-edit:before {\n  border-top: 0;\n}\n.cart-wrapper .goods-item-wrapper .vux-number-input {\n  font-size: 14px;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small {\n  padding-left: 0;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small .goods-img {\n  width: 1rem;\n  height: 1rem;\n  -webkit-box-flex: 0;\n      -ms-flex: 0 0 1rem;\n          flex: 0 0 1rem;\n  line-height: 1rem;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small .goods-img i {\n  line-height: 1rem;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small .vux-check-icon {\n  position: relative;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small .check-slot {\n  position: absolute;\n  bottom: 24px;\n}\n.cart-wrapper .goods-item-wrapper.goods-item-small .goods-num-edit,\n.cart-wrapper .goods-item-wrapper.goods-item-small .goods-num {\n  right: 0;\n}\n.cart-wrapper .popup {\n  background-color: #fff;\n}\n.cart-wrapper .popup .popup-header {\n  position: relative;\n  margin: 12px 18px 0;\n  padding-bottom: 10px;\n}\n.cart-wrapper .popup .popup-header .popup-title {\n  font-size: 14px;\n  font-weight: bold;\n  margin-right: 10px;\n}\n.cart-wrapper .popup .popup-header .popup-title span {\n  color: #9b9b9b;\n  font-size: 12px;\n  margin-left: 8px;\n  font-weight: normal;\n}\n.cart-wrapper .popup .popup-header i {\n  position: absolute;\n  padding: 10px;\n  top: -7px;\n  right: -10px;\n  font-size: 16px;\n  color: #d5d5d5;\n}\n.cart-wrapper .popup .popup-content {\n  margin: 0 18px;\n  max-height: 60vh;\n  overflow-y: scroll;\n}\n.cart-wrapper .popup .popup-content ul {\n  margin-bottom: 80px;\n}\n.cart-wrapper .popup .popup-content ul li {\n  position: relative;\n  list-style: none;\n  margin-top: 8px;\n}\n.cart-wrapper .popup .popup-content ul li .item-desc {\n  background-color: #fff7dd;\n  color: #ffae00;\n  line-height: 22px;\n  text-indent: .1rem;\n}\n.cart-wrapper .popup .popup-content ul li .goods-remark {\n  font-size: 12px;\n  color: #9b9b9b;\n  margin-top: 10px;\n}\n.cart-wrapper .popup .popup-content ul li.dis-active .item-desc {\n  background-color: #f1f1f1;\n  color: #d7d7d7;\n}\n.cart-wrapper .popup .popup-content ul li.dis-active .goods-title,\n.cart-wrapper .popup .popup-content ul li.dis-active .goods-info span {\n  color: #d7d7d7;\n}\n.cart-wrapper .popup .popup-content ul li.dis-active .zeng {\n  background-color: #d7d7d7;\n}\n.cart-wrapper .popup .popup-content ul li.dis-active .goods-img img {\n  opacity: .4;\n}\n.cart-wrapper .popup .popup-btn {\n  background-color: #ffc600;\n  color: #fff;\n  height: 43px;\n  line-height: 43px;\n  text-align: center;\n  font-size: 14px;\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n}\n.cart-wrapper .popup.zeng-popup .check-slot {\n  position: absolute;\n  width: 28px;\n  height: 45px;\n  top: -10px;\n  left: -25px;\n}\n.cart-wrapper .weui-dialog__hd {\n  padding: 1.3em 1.6em 0.5em !important;\n}\n.cart-wrapper .weui-dialog__bd {\n  padding: 0;\n}\n.cart-wrapper .weui-dialog__title {\n  font-size: 14px;\n}\n",""])}});
//# sourceMappingURL=50.1e9f464b8657e99ba5cf.js.map